在DNS响应中，OPT（Options）记录是一种特殊的资源记录（Resource Record，RR），用于支持EDNS0（Extension Mechanisms for DNS）。OPT记录通常被称为“伪记录”，因为它不直接关联于任何特定的域名。OPT记录的主要目的是在DNS消息中携带额外的信息，例如客户端支持的UDP包大小、DNSSEC支持等。

以下是OPT记录的格式定义：

+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                      NAME                     |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                      TYPE                     |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                     CLASS                     |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                      TTL                      |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    RDLENGTH                   |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    RDATA                     /
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
具体字段解释如下：

NAME：OPT记录的名称字段为0，表示这是一个伪记录，不关联于任何特定的域名。
TYPE：OPT记录的类型字段为41（即0x0029），表示这是一个OPT记录。
CLASS：OPT记录的类字段称为“UDP payload size”，表示客户端支持的最大UDP包大小。常见的值为4096（即0x1000）。
TTL：OPT记录的TTL字段称为“Extended RCODE”和“Version”，用于携带扩展的RCODE（Response Code）和EDNS版本信息。低8位表示EDNS版本，高24位表示扩展的RCODE。
RDLENGTH：OPT记录的RDLENGTH字段表示RDATA部分的长度。
RDATA：OPT记录的RDATA部分包含各种选项（Options），每个选项由一个选项代码（Option Code）、选项长度（Option Length）和选项数据（Option Data）组成。常见的选项包括DO（DNSSEC OK）标志，表示客户端支持DNSSEC。
以下是一个OPT记录的示例：

+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|0x0000|  // NAME: 0 (root)
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|0x0029|  // TYPE: OPT (41)
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|0x1000|  // CLASS: UDP payload size (4096)
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|0x00000900|  // TTL: Extended RCODE (0) and Version (9)
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|0x0000|  // RDLENGTH: 0 (no options)
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
通过这种方式，OPT记录可以在DNS消息中携带额外的信息，支持EDNS0扩展机制。

## 权威DNS服务器在以下情况下需要返回OPT附加记录：

客户端请求包含OPT记录：当客户端在DNS查询中包含OPT记录时，权威服务器应在响应中包含相同的OPT记录，以确保EDNS0功能的支持和兼容性。
支持EDNS0：如果权威服务器支持EDNS0扩展机制，它应在响应中返回OPT记录，以便与客户端进行有效的通信，特别是在处理大查询或响应时。
DNSSEC验证：在进行DNSSEC验证时，权威服务器需要在响应中包含OPT记录，以指示支持DNSSEC的标志（DO标志），从而确保客户端能够正确处理DNSSEC相关的数据。
简而言之，当客户端请求中包含OPT记录或权威服务器支持EDNS0和DNSSEC时，权威服务器应返回OPT附加记录。